# üìù Template de Application do ArgoCD

# Este √© um template para criar Applications no ArgoCD.
# Copie este arquivo, renomeie-o e ajuste os valores conforme necess√°rio.

# INSTRU√á√ïES:
# 1. Copie este arquivo: cp application-template.yaml api.yaml
# 2. Edite os valores entre <>
# 3. Aplique: terraform apply
# 4. A Application ser√° criada automaticamente no ArgoCD

---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: <SERVICE-NAME> # Nome da application (ex: api, worker, payment)
  namespace: argocd
  labels:
    app: <SERVICE-NAME>
    team: OptimusFrame
  finalizers:
    - resources-finalizer.argocd.argoproj.io # Garante limpeza dos recursos
spec:
  project: default

  # Fonte: De onde o ArgoCD vai buscar os manifestos
  source:
    repoURL: https://github.com/Optimus-Frame/optimus-frame-infra.git
    targetRevision: main # Branch, tag ou commit
    path: apps/<SERVICE-NAME>/prod # Caminho dos manifestos

  # Destino: Onde os recursos ser√£o criados
  destination:
    server: https://kubernetes.default.svc # Cluster local
    namespace: <SERVICE-NAME> # Namespace no Kubernetes

  # Pol√≠tica de sincroniza√ß√£o
  syncPolicy:
    automated:
      prune: true # Remove recursos deletados do Git
      selfHeal: true # Corrige drifts automaticamente
      allowEmpty: false # N√£o sincroniza se n√£o houver recursos

    syncOptions:
      - CreateNamespace=true # Cria namespace automaticamente se n√£o existir
      - PrunePropagationPolicy=foreground
      - PruneLast=true

    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m
