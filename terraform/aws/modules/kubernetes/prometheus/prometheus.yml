# Prometheus Helm Chart Values
# Chart: prometheus-community/prometheus
# Version: 25.27.0
# Reference: https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus
# Values Reference: https://github.com/prometheus-community/helm-charts/blob/main/charts/prometheus/values.yaml

# ============================================================================
# SUB-CHARTS CONFIGURATION
# ============================================================================

# Alertmanager - Alert management and routing
alertmanager:
  enabled: false

# Kube State Metrics - Kubernetes cluster metrics
kube-state-metrics:
  enabled: true

# Prometheus Node Exporter - Host/Node metrics
prometheus-node-exporter:
  enabled: true
  rbac:
    pspEnabled: false
  containerSecurityContext:
    allowPrivilegeEscalation: false
  
  # Disable hostPort to avoid port conflicts (use ClusterIP instead)
  service:
    type: ClusterIP
    port: 9100
  
  # Remove hostNetwork to avoid port binding issues
  hostNetwork: false
  
  # Tolerate all taints to run on all nodes
  tolerations:
    - operator: Exists
  
  # Remove NodeAffinity restrictions
  affinity: {}

# Prometheus Pushgateway - For batch job metrics
prometheus-pushgateway:
  enabled: false

# ============================================================================
# PROMETHEUS SERVER CONFIGURATION
# ============================================================================

server:
  enabled: true

  # Service configuration
  service:
    type: ClusterIP
    servicePort: 80

  # Data persistence configuration
  persistentVolume:
    enabled: ${enable_persistence}
    size: ${storage_size}
    storageClass: ${storage_class}
    accessModes:
      - ReadWriteOnce

  # Data retention period
  retention: "${retention_days}d"

  # Resource allocation
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

  # Global Prometheus settings
  global:
    scrape_interval: 15s
    scrape_timeout: 10s
    evaluation_interval: 15s

  # Ingress (disabled - using nginx-ingress controller)
  ingress:
    enabled: false

  # Security context
  securityContext:
    runAsUser: 65534
    runAsNonRoot: true
    runAsGroup: 65534
    fsGroup: 65534

  # Readiness and liveness probes
  readinessProbeInitialDelay: 30
  readinessProbePeriodSeconds: 5
  readinessProbeTimeout: 4
  readinessProbeFailureThreshold: 3
  readinessProbeSuccessThreshold: 1

  livenessProbeInitialDelay: 30
  livenessProbePeriodSeconds: 15
  livenessProbeTimeout: 10
  livenessProbeFailureThreshold: 3
  livenessProbeSuccessThreshold: 1
